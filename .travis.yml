language: java

env:
  global:
    secure: "OkCM+FMR3hHXUfMsSSWl6LFBUVrGPozrfeSVS/xPkBQkGtX2oeo1f0MLagUXv19pSJSTPDuLmXjAMzdmDT/htZ6/YMK4D72eUS1djnXLO1S3UjEMyDymP0OTi0iljmqyMalCNevrA+o97O7kHcS8rWjdZOW/aE+0TprRSB+waZnRXg0rZej6ERnlotEytPLsqTxsukKY8oEGCMk8p0KkSkJyfB/XXChwA/5+ZIo9dybIqQI0EuN+tZ5fERE0qQ+5nxLHq7pBBjEqT7ZhVyFw04rQSyKyB2JDRNuqEAHAOX3nE+kYJo8ChsfnEPQaqrx6zFBe72UuOQ8yLJRyZ2RC+Kklhn1f0YhepCWwMTXNP6Y4IsPe94ngNhz3dBqbEylgnv5jVaY8EdpUzE+J/+4+aSGrwdPfBNkASy0RKpJH617XhnR+vd8ke4aS/bcJywdA3D4m05s03Y+dLxwrPaJJ+F+bMZzGSmyGJkd1FO7H8FsvrkAKCpAoZqGGtLHgNJQgY3/R0t/GSf2G3vQ/i7zDzrNBa8AqeFL0g8jhU2GyXsAAu7mUsPIjzwZvllH2DO8q+fvzsU+5vJLSHGWsiMjNysJiq8cwOww08CaFm0OfArWOR74OdNBtJSkvaiIMGSgsL3bA9ZbQZ4CEJ4DBzQPrqkSUflloLjeYy3k+UtClsV0="

jdk:
- oraclejdk8

services:
  - mongodb
  - rabbitmq

sudo: required

branches:
  only:
  - staging

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

after_success:
- chmod a+x merge_script.sh
- BRANCHES_TO_MERGE_REGEX='staging' BRANCH_TO_MERGE_INTO=develop GITHUB_REPO=symbiote-h2020/coreInterfaceAPI
  ./merge_script.sh
- bash <(curl -s https://codecov.io/bash)
